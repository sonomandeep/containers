---
import Card from "../ui/Card.astro";

type LogTone = "info" | "warning" | "error";

type LogRow = {
  tone: LogTone;
  service: string;
  message: string;
};

type Props = {
  class?: string;
};

const { class: className = "" } = Astro.props as Props;
const cardClass = `h-80 justify-end ${className}`.trim();

const logRows: Array<LogRow> = [
  {
    tone: "info",
    service: "nginx",
    message: "Worker process started successfully, listening on port 80",
  },
  {
    tone: "info",
    service: "api",
    message: "Retrying database connection (attempt 2/5)",
  },
  {
    tone: "warning",
    service: "web",
    message: "Slow response detected on /api/products (1.8s)",
  },
  {
    tone: "warning",
    service: "redis",
    message: "Memory usage at 82%, eviction may occur soon",
  },
  {
    tone: "error",
    service: "api",
    message: "Failed to connect to postgres: connection timeout",
  },
  {
    tone: "info",
    service: "postgres",
    message: "Database system ready to accept connections",
  },
  {
    tone: "error",
    service: "nginx",
    message: "Upstream server api:3000 is not responding (502 Bad Gateway)",
  },
  {
    tone: "info",
    service: "web",
    message: "Build assets loaded, server running in production mode",
  },
  {
    tone: "info",
    service: "redis",
    message: "Background saving completed successfully",
  },
  {
    tone: "warning",
    service: "postgres",
    message: "Autovacuum process taking longer than expected",
  },
  {
    tone: "info",
    service: "worker",
    message: "Job queue processor started (concurrency=4)",
  },
  {
    tone: "warning",
    service: "api",
    message: "Deprecated endpoint /v1/orders accessed by client 10.0.4.21",
  },
  {
    tone: "info",
    service: "nginx",
    message: "Starting nginx 1.25.3",
  },
  {
    tone: "info",
    service: "nginx",
    message: "Starting nginx 1.25.3",
  },
  {
    tone: "info",
    service: "nginx",
    message: "Starting nginx 1.25.3",
  },
];

const toneClasses: Record<LogTone, string> = {
  info: "text-blue-600",
  warning: "text-amber-600",
  error: "text-red-600",
};
---

<Card as="article" class={cardClass}>
  <div aria-hidden="true" class="relative flex-1 overflow-hidden pb-8">
    <div class="space-y-2">
      <div
        class="grid grid-cols-[64px_64px_minmax(0,1fr)] gap-x-1.5 font-mono text-[10px] tracking-[0.06em] text-neutral-400 uppercase"
      >
        <span>SERVICE</span>
        <span>LEVEL</span>
        <span>MESSAGE</span>
      </div>

      <div
        class="grid grid-cols-[64px_64px_minmax(0,1fr)] gap-x-1.5 gap-y-1 text-xs leading-[1.25]"
      >
        {
          logRows.map((row) => (
            <div class="contents">
              <span class="font-mono text-neutral-500">[{row.service}]</span>
              <span class={`font-mono ${toneClasses[row.tone]}`}>
                {row.tone.toUpperCase()}
              </span>
              <span class="truncate text-neutral-700">{row.message}</span>
            </div>
          ))
        }
      </div>
    </div>

    <div
      class="pointer-events-none absolute inset-x-0 bottom-0 h-40 bg-linear-to-b from-transparent from-45% to-neutral-50"
    />
  </div>

  <h3
    class="font-display text-base font-medium tracking-[-0.01em] text-neutral-800"
  >
    Log stream
  </h3>
  <p class="mt-1 max-w-[13.375rem] text-balance text-sm text-neutral-500">
    Follow your containers log stream from Paper interface.
  </p>
</Card>
